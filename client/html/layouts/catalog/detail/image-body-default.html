<?php

/**
 * @copyright Copyright (c) Metaways Infosystems GmbH, 2012
 * @license LGPLv3, http://www.arcavias.com/en/license
 */

$enc = $this->encoder();
$contentUrl = $this->config( 'client/html/common/content/baseurl' ) . '/';

if( isset( $this->detailProductItem ) ) {
	$mediaItems = $this->detailProductItem->getRefItems( 'media', 'default', 'default' );
} else {
	$mediaItems = array();
}

$detailTarget = $this->config( 'client/html/catalog/detail/url/target' );
$detailController = $this->config( 'client/html/catalog/detail/url/controller', 'catalog' );
$detailAction = $this->config( 'client/html/catalog/detail/url/action', 'detail' );

$url = $enc->attr( $this->url( $detailTarget, $detailController, $detailAction, $this->get( 'detailParams', array() ) ) );

?>
<div class="catalog-detail-image">
	<div class="image-single">
		<div class="carousel">
<?php foreach( $mediaItems as $id => $mediaItem ) : ?>
<?php	$previewUrl = $enc->attr( $contentUrl . $mediaItem->getPreview() ); ?>
			<div id="image-<?php echo $enc->attr( $id ); ?>" class="item"
				style="background-image: url('<?php echo $previewUrl; ?>')"
				data-image="<?php echo $previewUrl; ?>"
				data-zoom-image="<?php echo $enc->attr( $contentUrl . $mediaItem->getUrl() ); ?>">
			</div>
<?php endforeach; ?>
		</div>
	</div>
	<div class="image-thumbs">
		<a class="prev-thumbs disabled"></a>
		<a class="next-thumbs disabled"></a>
		<div class="thumbs">
<?php
	if( count( $mediaItems ) > 1 )
	{
		$class = 'item selected';
		foreach( $mediaItems as $id => $mediaItem )
		{
			echo '<a href="' . $url . '#image-' . $id . '" class="' . $class . '" style="background-image: url(\'' . $enc->attr( $contentUrl . $mediaItem->getUrl() ) . '\')"></a>';
			$class = 'item';
		}
	}
?>
		</div>
	</div>
<?php echo $this->get( 'imageBody' ); ?>
</div>
