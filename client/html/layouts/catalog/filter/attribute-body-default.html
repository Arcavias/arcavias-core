<?php

/**
 * @copyright Copyright (c) Metaways Infosystems GmbH, 2013
 * @license LGPLv3, http://www.arcavias.com/en/license
 */

$enc = $this->encoder();
$aggregate = $this->get( 'attributeAggregate', array() );
$attrIds = $this->param( 'f-attr-id', array() );

if( is_string( $attrIds ) ) {
	$attrIds = explode( ' ', $attrIds );
}

$attrIds = array_flip( $attrIds );

?>
<section class="catalog-filter-attribute">
<?php foreach( $this->get( 'attributeMap', array() ) as $attrType => $attributes ) : ?>
<?php if( !empty( $attributes ) ) : ?>
<fieldset class="attr-<?php echo $enc->attr( $attrType ); ?>">
	<legend><?php echo $enc->html( $this->translate( 'client/html/code', $attrType ), $enc::TRUST ); ?></legend>
	<ul class="attr-list">
<?php		foreach( $attributes as $id => $attribute ) : ?>
<?php			$count = ( isset( $aggregate[$id] ) ? $aggregate[$id] : 0 ); ?>
		<li class="attr-item <?php echo ( $count == 0 ? 'disabled' : '' ); ?>">
			<input class="attr-item" name="f-attr-id[]" type="checkbox" value="<?php echo $enc->attr( $id ); ?>" <?php echo ( isset( $attrIds[$id] ) ? 'checked="checked"' : ( $count == 0 ? 'disabled="disabled"' : '' ) ); ?> />
			<span class="attr-item"><?php echo $enc->html( $attribute->getName(), $enc::TRUST ); ?></span>
			<span class="attr-count"><?php echo $enc->html( $count ); ?></span>
		</li>
<?php 		endforeach; ?>
	</ul>
</fieldset>
<?php	endif; ?>
<?php endforeach; ?>
<?php echo $this->attributeBody; ?>
</section>
